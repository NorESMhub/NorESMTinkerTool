
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../installation/">
      
      
        <link rel="next" href="../cli/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Configuration - NorESMTinkerTool</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#base-configuration-of-ppe-runs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NorESMTinkerTool" class="md-header__button md-logo" aria-label="NorESMTinkerTool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NorESMTinkerTool
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuration
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NorESMTinkerTool" class="md-nav__button md-logo" aria-label="NorESMTinkerTool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NorESMTinkerTool
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLI
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Usage
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="base-configuration-of-ppe-runs">Base Configuration of PPE runs</h1>
<p>Before a PPE ensemble can be created, a base configuration of NorESM must specified. 
The arguments to pass in to the <a href="../cli/">CLI</a> and <a href="../usage/">API</a> is generally self explanatory, except for the <code>simulation_setup.ini</code> file which you provide to 'simulation_setup_path' and which have to follow a specific template.</p>
<p>This file contain extensive information on the base configuration of each of the PPE simulations. Each ensemble of the PPE will share the same configuration. Current setup uses the following sections; <code>create_case</code>, <code>env_run</code>, <code>env_build</code>, <code>ppe_settings</code>, <code>namelist_control</code> and <code>lifeCycleValues</code>.</p>
<p><strong>create_case</strong> - This section holds key-value pairs used for creating a new case, i.e. what one does when running <code>./cime/scripts/create_newcase &lt;args&gt;</code>. <em>Required</em> keys are <code>cesm_root</code>, <code>res</code>, <code>compset_name</code>, <code>project</code>, <code>mach</code>, <code>walltime</code> and so a valid section will consist of:</p>
<pre><code class="language-ini">[create_case]
cesm_root   = &lt;absolute path to NorESM&gt;
res         = &lt;long resolution name or alias&gt;
compset     = &lt;long compeset name or alias&gt;
project     = &lt;project name&gt;
mach        = &lt;machine name&gt;
walltime    = &lt;wall clock time per case&gt;
</code></pre>
<p>It is possible to use additional key-value pairs in this section as well. As key-value pairs are given to <code>Case.create()</code> (where <code>Case</code> is an object defined from <code>NorESM/cime/CIME/case/case.py</code>) available/unused key word arguments include <code>user_mods_dirs</code>, <code>pecount</code>, <code>compiler</code>, <code>mpilib</code>, <code>pesfile</code>, <code>gridfile</code>, <code>multi_driver</code>, <code>ninst</code>, <code>test</code>, <code>queue</code>, <code>output_root</code>, <code>input_dir</code>, <code>workflowid</code>, <code>non_local</code>, <code>extra_machines_dir</code> and <code>case_group</code>. <strong>Note</strong>: Arguments <code>run_unsupported=True</code>, <code>driver="mct"</code>, <code>answer="r"</code> are <em>"hard coded"</em> in <code>tinkertool.setup.case.build_base_case()</code> and is therefor not available. We referr to the CIME source code for proper usage of the available/unused key word arguments.</p>
<p><strong>env_run</strong> and <strong>env_build</strong> - This section holds key-value pairs used for setting enviromental variables for the model, i.e. what ones does when using <code>./xmlchange</code> in a case directory. <em>Required</em> keys are <code>RUN_TYPE</code>, <code>STOP_OPTION</code>, <code>STOP_N</code> and <code>RUN__STARTDATE</code>. In addition this implementation has explicit handling off <code>GET_REFCASE</code>, <code>RUN_REFCASE</code>, <code>RUN_REFDIR</code>, <code>RUN_REFDATE</code>, <code>REST_OPTION</code>, <code>REST_N</code> for <em>env_run</em> and <code>CALENDAR</code>for <em>env_build</em>. To change <code>CAM_CONFIG_OPTS</code> there are two options; 1. provide a full and valid version of <code>CAM_CONFIG_OPTS</code>, this will overwrite the default in full, or 2. provide <code>cam_onopts</code>, this will add the options to the default. A valid/recomended <em>env_run</em> and <em>env_build</em> section is then:</p>
<pre><code class="language-ini">[env_run]
RUN_TYPE        = &lt;type of run&gt;
STOP_OPTION     = &lt;measure of time to use for STOP_N&gt;
STOP_N          = &lt;count of the STOP_OPTION meassure to stop run at&gt;
RUN_STARTDATE   = &lt;date to start calendar in run&gt;
; recomended entries for non-startup runs
GET_REFCASE     = &lt;Flag for automatically prestaging the refcase restart dataset&gt;
RUN_REFCASE     = &lt;Reference case for hybrid or branch runs&gt;
RUN_REFDIR      = &lt;Reference directory containing RUN_REFCASE data&gt;
RUN_REFDATE     = &lt;Reference date for hybrid or branch runs (yyyy-mm-dd)&gt;
REST_OPTION     = &lt;measure for frequency of model restart writes&gt;
REST_N          = &lt;count of the REST_OPTION meassure&gt;
; specially handled keys
CAM_CONFIG_OPTS = &lt;replacement to existing CAM_CONFIG_OPTS&gt;
; OR
cam_onopts      = &lt;string to add to existing CAM_CONFIG_OPTS&gt;

[env_build]
CALENDAR  = GREGORIAN
</code></pre>
<p>It is possible to use additional key-value pairs in this section as well. As key-value pairs are given to <code>Case.set_value()</code> (where <code>Case</code> is an object defined from <code>NorESM/cime/CIME/case/case.py</code>) available/unused are available by running <code>./xmlquery --listall</code> in a case directory. To see information for a key run <code>./xmlquery &lt;key&gt; --full</code>. <strong>NOTE</strong>: Additional key-value pairs to those already discussed are attempted set using a loop over remaining pairs, a warning is raised if it is not successfull but program will not exit. This is done <em>after</em> the handling of the other keys.</p>
<p><strong>ppe_settings</strong> - This section holds key-value paris used for pointing to the parameter file previously discussed and ensuring correct case paths for PPE members. <em>Required</em> keys are <code>paramfile</code>, <code>pdim</code>, <code>baseroot</code>, <code>basecasename</code>, <code>basecase_id</code> and <code>assumed_esm_component</code>. A valid section is therefore:</p>
<pre><code class="language-ini">paramfile             = &lt;absolute path to .nc parameter samples&gt;
pdim                  = &lt;ensamlbe number dimension name in paramfile&gt;
baseroot              = &lt;absolute path to where you want ppe cases&gt;
basecasename          = &lt;name of basecase&gt;
basecase_id           = &lt;number used id-ing the basecase, e.g. 000 if we include default or 001 if we exclude it&gt;
assumed_esm_component = &lt;assumed component for variables in paramfile which dont have
                         'component' attribute. Used to send variable to the correct user_nl file &gt;
</code></pre>
<p>Further key-value pairs is not implemented as of now.</p>
<p><strong>namelist_control</strong> - This section holds key-value pairs used for pointing to .ini files used to generate custom user_nl_<component> files. A valid section would be something like</p>
<pre><code class="language-ini">[namelist_control]
control_atm = &lt;path to control_atm.ini or None (example in input_file_templates/template_control_atm.ini)&gt;
control_cpl = &lt;path to control_cpl.ini or None (example in input_file_templates/template_control_cpl.ini)&gt;
control_cice = &lt;path to control_cice.ini or None (example in input_file_templates/template_control_cice.ini)&gt;
control_clm = &lt;path to control_clm.ini or None(example in input_file_templates/template_control_clm.ini)&gt;
control_docn = &lt;path to control_docn.ini or None(example in input_file_templates/template_control_docn.ini)
</code></pre>
<p>If a <code>control_&lt;component&gt;</code> key is <code>= None</code> the model default one is used, otherwise the <code>.ini</code> file is used to create a string replacing user_nl_<component> via the follow ini-file syntax, e.g.:</p>
<pre><code>[metadata_nl]
met_data_file = /cluster/shared/noresm/inputdata/noresm-only/inputForNudging/ERA_f09f09_32L_days/2014-01-01.nc
met_filenames_list = /cluster/shared/noresm/inputdata/noresm-only/inputForNudging/ERA_f09f09_32L_days/fileList2001-2015.txt
met_nudge_only_uvps = .true.
met_nudge_temp = .false.
met_rlx_time = 6
met_srf_land = .false.

[cam_initfiles_nl]
bnd_topo=/cluster/shared/noresm/inputdata/noresm-only/inputForNudging/ERA_f09f09_32L_days/ERA_bnd_topo_noresm2_20191023.nc

[camexp]
empty_htapes = .true.
nhtfrq=0,-24
mfilt=1,30
cosp_passive=.true.
use_aerocom=.true.
history_aerosol=.true.
avgflag_pertape = A
fincl1 = AQRAIN
         AQSNOW
         AREI
         ACTREI
         ACTREL
         ACTNI
         ACTNL
         AWNC
         AWNI
         AIRMASS
         AIRMASSL
         ABS870
...
</code></pre>
<p>Each section correspond to namelist group. Valid namelist variables are described in <code>namelist_definition*.xml</code> files:
* CAM - <code>NorESM/components/cam/bld/namelist_files/namelist_definition.xml</code>
* ...</p>
<p><strong>NOTE</strong>: You do not need to add the name of the parameters you are pertermbing to these .ini files.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>